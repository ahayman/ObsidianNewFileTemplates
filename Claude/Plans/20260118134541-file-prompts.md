# Plan: File Prompts

## Overview

Add support for prompts in file template content. When creating a new file, prompts found in the file template are displayed in a "File Prompts" section and replaced with user values before Templates/Templater processing. Also add a command to process prompts in existing files.

---

## Phase 1: Extract File Prompts from Template Content

- [x] Add function `extractPromptsFromContent(content: string): UserPrompt[]` to promptParser.ts
- [x] Add function `substitutePromptsInContent(content: string, prompts: UserPrompt[], values: PromptValues): string` to promptParser.ts
- [x] Add function `hasPromptsInContent(content: string): boolean` to promptParser.ts
- [x] Add unit tests for the new functions

---

## Phase 2: Update PromptEntryView for Sections

- [x] Update PromptEntryViewProps to accept `titlePrompts` and `filePrompts` separately
- [x] Add section headers "Title Prompts" and "File Prompts" when both exist
- [x] Only show relevant section if prompts exist
- [x] Update preview logic to handle both types
- [x] Update submit to return both title and file prompt values

---

## Phase 3: Update File Creation Flow

- [x] In `createFileFromTemplate`, extract prompts from file template content
- [x] Pass both title and file prompts to prompt entry modal
- [x] After user submits, substitute file prompts in content BEFORE processing file template
- [x] Update FileService to handle pre-processed content

Order of processing:
1. User enters values for title prompts + file prompts
2. Generate filename from title pattern with title prompt values
3. Substitute file prompts in file template content with file prompt values
4. Process file template ({{title}}, {{date}}, etc.)
5. Process with Templater (if enabled)
6. Create file

---

## Phase 4: Add "Enter File Prompts" Command

- [x] Add new command `enter-file-prompts` in main.ts
- [x] Get active file, read its content
- [x] Extract prompts from content using `extractPromptsFromContent()`
- [x] If no prompts found, show toast: "No prompts found in this file"
- [x] If prompts found, open FilePromptEntryModal with file prompts only
- [x] On submit, substitute prompts in file content and save

---

## Phase 5: Create File-Only Prompt Entry Modal

- [x] Create `FilePromptEntryModal` with `FilePromptEntryView` component
- [x] Shows file name instead of title preview
- [x] Submit button says "Update File" instead of "Create File"
- [x] Create `openFilePromptEntryModal()` function

---

## Phase 6: Unit Tests

Add comprehensive unit tests for file prompt processing:

### extractPromptsFromContent tests
- [x] Extract single text prompt from content
- [x] Extract multiple prompts from content
- [x] Extract prompts with inline type configuration (`:text`, `:number`, `:date`)
- [x] Extract prompts with format presets (`:date:ISO`, `:datetime:US,12-hour`)
- [x] Extract optional prompts (`{%? Name ?%}`)
- [x] Handle duplicate prompt names (should return unique prompts)
- [x] Return empty array when no prompts in content
- [x] Ignore prompts inside code blocks (``` fenced)
- [x] Handle prompts with special characters in names

### substitutePromptsInContent tests
- [x] Substitute single prompt with value
- [x] Substitute multiple prompts with values
- [x] Substitute duplicate prompt names (same value for all occurrences)
- [x] Substitute optional prompts with empty value (empty string)
- [x] Substitute prompts with inline configuration syntax
- [x] Preserve content outside of prompt syntax
- [x] Handle multiline content with prompts
- [x] Handle prompts at start/end of content
- [x] Handle adjacent prompts

### Integration tests
- [x] Full flow: extract prompts → collect values → substitute
- [x] Mixed required and optional prompts
- [x] Prompts with various value types and formats

---

## Phase 7: Build and Test

- [x] Build passes with no TypeScript errors
- [x] All 377 tests pass

---

## File Changes Summary

| File | Changes |
|------|---------|
| `src/utils/promptParser.ts` | Add `extractPromptsFromContent`, `hasPromptsInContent`, `substitutePromptsInContent` |
| `src/utils/promptParser.test.ts` | Add 48 tests for file prompt functions |
| `src/modals/PromptEntryView.tsx` | Add section support for title/file prompts |
| `src/modals/PromptEntryModal.tsx` | Update to handle sectioned prompts, return `PromptEntryResult` |
| `src/modals/FilePromptEntryModal.tsx` | New modal for file-only prompt entry |
| `src/main.ts` | Add "Enter File Prompts" command, update file creation flow |
| `styles.css` | Add section header styles |

---

## Commit Message

```
Add file prompts support and "Enter File Prompts" command

- Extract and display prompts from file template content
- Show "File Prompts" section in prompt entry when both title and file prompts exist
- Replace file prompts with values before Templates/Templater processing
- Add "Enter File Prompts" command for processing prompts in existing files
- Show toast when no prompts found in file
- Ignore prompts inside code blocks
- Add 48 unit tests for file prompt functions
```

# List Picker Feature Implementation Plan

Based on spec: `/Claude/Specs/2-ListPicker.md`

## Overview

Implement two list picker variants for user prompts:
- **Simple List Picker** (`list`): Single selection dropdown
- **Multi List Picker** (`multilist`): Multiple selection dropdown

Syntax formats:
- Simple: `{% Field Name:list:Value 1,Value 2,Value 3 %}`
- Multi: `{% Field Name:multilist:Value 1,Value 2,Value 3 %}`

---

## Phase 1: Type Definitions & Parser Updates

### Files to modify:
- `/src/types.ts`
- `/src/utils/promptParser.ts`

### Tasks:
- [x] Add `list` and `multilist` to `PromptValueType` union type in `types.ts`
- [x] Add `listConfig` interface to `UserPrompt` in `types.ts`:
  ```typescript
  listConfig?: {
    options: string[];
    isMulti?: boolean;
  };
  ```
- [x] Add `listOptions` field to `ParsedPromptSyntax` interface in `types.ts`
- [x] Add `list` and `multilist` to `VALUE_TYPE_ALIASES` map in `promptParser.ts`
- [x] Update `parsePromptSyntax()` to parse comma-separated options for list types
- [x] Update `createFullPromptSyntax()` to generate list syntax
- [x] Add validation for list types in `validatePromptValue()` (ensure value is in options list)

---

## Phase 2: Create List Picker Components

### Files to create:
- `/src/components/pickers/ListPicker.tsx`
- `/src/components/pickers/MultiListPicker.tsx`

### Simple List Picker (`ListPicker.tsx`):
- [x] Create component with props: `value`, `options`, `onChange`, `onClear`
- [x] Implement dropdown that opens on focus
- [x] Display options in scrollable list
- [x] Highlight currently selected option
- [x] Close dropdown automatically on selection
- [x] Include clear button (X) to remove selection
- [x] Support keyboard navigation (arrow keys, Enter, Escape)
- [x] Handle click outside to close dropdown

### Multi List Picker (`MultiListPicker.tsx`):
- [x] Create component with props: `values`, `options`, `onChange`, `onClear`
- [x] Implement dropdown that opens on focus
- [x] Display options with checkmarks for selected items
- [x] Use alternate background color for selected items
- [x] Toggle selection on click (select/deselect)
- [x] Keep dropdown open after selection
- [x] Include clear button to remove all selections
- [x] Support keyboard navigation
- [x] Handle click outside to close dropdown
- [x] Display selected items count or summary in input field

### Export components:
- [x] Update `/src/components/pickers/index.ts` to export new components

---

## Phase 3: Integrate into Prompt Entry Modal

### Files to modify:
- `/src/modals/PromptEntryView.tsx`

### Tasks:
- [x] Import `ListPicker` and `MultiListPicker` components
- [x] Update `renderPromptField()` to handle `list` valueType
- [x] Update `renderPromptField()` to handle `multilist` valueType
- [x] Handle state management for list selections
- [x] For multilist: convert array to comma-separated string for output
- [x] Update type labels to include list types

---

## Phase 4: Settings Screen Builder

### Files to modify:
- `/src/settings/PromptEditor.tsx`

### Tasks:
- [x] Add list type options to value type dropdown
- [x] Create list options input section (appears when list/multilist selected)
- [x] Add text area for entering options (comma-separated)
- [x] Display preview of parsed options as tags/chips
- [x] Add validation: require at least 2 options for list types
- [x] Show syntax preview (e.g., `{% Field:list:Opt1,Opt2,Opt3 %}`)
- [x] Update prompt object construction to include `listConfig`
- [x] Update PromptListItem typeLabels for list types

---

## Phase 5: Autocomplete Support

### Files to modify:
- `/src/components/SyntaxInput.tsx`

### Tasks:
- [x] Add `list` type to prompt type completions with description
- [x] Add `multilist` type to prompt type completions with description
- [x] Show example syntax in autocomplete hints
- [x] Update completions to show format help after type selection

---

## Phase 6: Styling

### Files to modify:
- `/styles.css`

### Tasks:
- [x] Style dropdown container (`.list-picker`, `.multi-list-picker`)
- [x] Style dropdown options list
- [x] Style option hover state
- [x] Style selected option (single list)
- [x] Style multi-select checkmark icon
- [x] Style multi-select alternate background for selected items
- [x] Style clear button
- [x] Style selected items summary/count display
- [x] Ensure consistent sizing with other picker components
- [x] Add smooth animations for dropdown open/close
- [x] Ensure mobile/responsive compatibility
- [x] Style textarea and list options preview tags

---

## Phase 7: Testing & Edge Cases

### Build Verification:
- [x] Build compiles successfully

### Unit Tests Added:
- [x] `parsePromptSyntax` - list and multilist type parsing
- [x] `parsePromptSyntax` - list option trimming and filtering
- [x] `parsePromptSyntax` - optional list syntax
- [x] `parsePromptSyntax` - case-insensitive type matching
- [x] `extractPrompts` - list prompts with listConfig
- [x] `extractPrompts` - multilist prompts with listConfig
- [x] `extractPrompts` - optional list prompts
- [x] `validatePromptValue` - valid list options
- [x] `validatePromptValue` - invalid list options
- [x] `validatePromptValue` - required/optional list handling
- [x] `validatePromptValue` - multilist single and multiple options
- [x] `validatePromptValue` - multilist invalid option detection
- [x] `createFullPromptSyntax` - list syntax generation
- [x] `createFullPromptSyntax` - multilist syntax generation
- [x] `createFullPromptSyntax` - optional list syntax
- [x] `createFullPromptSyntax` - empty options edge case
- [x] Roundtrip tests - list and multilist through extractPrompts

### Manual Testing Checklist:
- [ ] Simple list: Select option and verify value insertion
- [ ] Simple list: Clear selection and verify empty state
- [ ] Simple list: Keyboard navigation works (arrows, Enter, Escape)
- [ ] Multi list: Select multiple options
- [ ] Multi list: Deselect option by clicking again
- [ ] Multi list: Clear all selections
- [ ] Multi list: Verify output format (`Value 1, Value 3` - comma+space separated)
- [ ] Syntax parsing: Valid syntax parses correctly
- [ ] Syntax parsing: Handles spaces in values
- [ ] Syntax parsing: Handles empty options gracefully
- [ ] Settings builder: Can add/edit/remove options
- [ ] Settings builder: Syntax preview updates live
- [ ] Optional prompts: Empty selection allowed when optional
- [ ] Required prompts: Validation enforces selection

### Edge Cases:
- [ ] Empty options list (should show error/warning)
- [ ] Single option in list (should still work)
- [ ] Very long option text (truncation with tooltip)
- [ ] Many options (scrollable dropdown with max-height)
- [ ] Options with special characters (except commas)
- [ ] Whitespace trimming on option values

---

## Commit Message

```
feat: Add list picker components for single and multi-select prompts

- Add list and multilist prompt value types
- Create ListPicker component for single selection dropdown
- Create MultiListPicker component for multi-selection dropdown
- Update prompt parser to handle comma-separated options
- Add list builder UI in settings prompt editor
- Add autocomplete support for list types
- Style new components consistently with existing pickers

Syntax: {% Field:list:Opt1,Opt2,Opt3 %}
        {% Field:multilist:Opt1,Opt2,Opt3 %}

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

---

## Implementation Notes

### Parsing Logic
The format part after the second colon contains comma-separated values:
```
{% Name:list:Value 1,Value 2,Value 3 %}
         ↑    ↑
       type  options (split by comma, trim whitespace)
```

### Output Format for Multi-select
When multiple items selected: `['A', 'C']` → `A, C`
- Join with `, ` (comma + space)
- No trailing comma or space

### Existing Patterns to Follow
- Use `CollapsiblePicker` wrapper like DatePicker/TimePicker
- Follow `SearchableSelect` component for dropdown patterns
- Use `file-template-*` CSS class naming convention
- Maintain keyboard accessibility throughout

### State Management
- Single list: `string` value
- Multi list: `string[]` values, convert to comma-separated string on output
